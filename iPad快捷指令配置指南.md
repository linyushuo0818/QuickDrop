# 📱 iPad 快捷指令配置指南 v2.6 (扫码即用版)

本指南帮助你配置 IP 动态更新和双向传输功能。

---

## 🛠️ 必做：创建配置助手 "OmniDrop 配置"

这个简单的快捷指令只做一件事：**扫描屏幕上的二维码，自动更新 IP 地址**。以后 IP 变了，运行一下它，扫一下屏幕即可，不用手动改。

**步骤详情：**
1. 打开快捷指令 App，点击右上角 `+` 新建。
2. 顶部改名为 **"OmniDrop 配置"**。
3. 添加动作 **"扫描二维码"** (Scan QR Code)。
4. **[重要]** 添加动作 **"获取文本"** (Get Text from Input):
   - 输入会自动连接到上一步的 `[二维码]`。
   - 这一步是为了确保我们只保存网址文字，而不是保存成了一张图片。
5. 添加动作 **"存储文件"** (Save File):
   - **输入**: 选择上一步的 `[文本]` (Text)。
   - **目标路径**: 点击 "快捷指令" (Shortcuts) 文件夹。
   - **文件名**: `OmniDrop_Config.txt`。
   - **覆盖**: 开启 "如果文件存在则覆盖"。
5. 添加动作 **"显示通知"** (Show Notification):
   - 内容填写: `"配置已更新: [二维码]"`。
6. 点击完成。

👉 **现在试一下**：并在电脑网页右上角点击 "📱 扫码连接"，用这个快捷指令扫一下。如果有通知弹出，说明配置成功！

---

## ⚡️ 主力指令： "传送门" (发送到电脑)

**逻辑升级说明：**
我们修改它，让它每次运行前**先去读取**上面那个文件里的 IP 地址。

**步骤 1：读取配置**
*(在所有逻辑的最开头添加)*
1. **获取文件** (Get File):
   - 路径: `Shortcuts/OmniDrop_Config.txt`
   - 错误处理: 如果文件不存在，提示 "请先运行 'OmniDrop 配置' 快捷指令"。
2. **设置变量** (Set Variable):
   - 变量名: `Server`
   - 值: `[文件内容]` (即上一步获取的内容)

**步骤 2：使用变量**
*(接下来的所有网络请求，不再手动填 IP，而是用变量)*
- 比如原来的 `http://192.168.1.5:3001/url`
- 改为: `[Server]/url` (注意：Server 变量里已经包含了 http:// 前缀，不要重复)

*(后续 4 段式判断逻辑保持不变，参考旧版指南或直接复制...)*

---

## 📥 接收指令："从电脑获取" (OmniPick)

这个快捷指令用于从电脑上拉取刚才你推送的内容。

**第一步：读取配置 (必须做)**
*(因为我们不手动填 IP 了，所以第一步永远是读取前面配置好的文件)*
1. **获取文件** (Get File):
   - **文件路径**: `Shortcuts/OmniDrop_Config.txt` (注意大小写 / 扩展名)
   - **错误处理**: 关掉 "如果未找到时报错" (Error if not found)，可以自己加个提示，也可以不管。
2. **设置变量** (Set Variable):
   - **变量名**: `Server`
   - **值**: 选择上一步的 `[文件]` 内容。

**第二步：获取数据**
3. **获取 URL 内容** (Get Contents of URL):
   - **URL**: `[Server]/pull` (输入变量 `[Server]` 然后手动打 `/pull`)
   - **方法 (Method)**: `GET`
4. **获取字典** (Get Dictionary from Input):
   - 输入选择上一步的 `[URL 内容]`。
5. **获取字典值** (Get Dictionary Value):
   - **键 (Key)**: `status`
   - **字典**: 选择上一步的 `[字典]`。

**5.5. [关键] 获取文本** (Get Text from Input):
   - **这一步非常重要！** 能够解决"没有选项"的问题。
   - 添加动作 **"获取文本"**。
   - 输入选择上一步的 `[字典值]`。
   - *(原理：强制让快捷指令知道这是一个文字，而不是一个未知对象)*

6. **如果** (If):
   - **输入**: 选择上一步的 `[文本]` (注意选新的这个，别选旧的字典值)。
   - **条件**: 现在你应该能看到 **"是" (is)** 这个选项了！
   - **文本**: `ok`
   
**第三步：处理数据 (注意：所有动作都要拖进去，放在 "如果" 和 "否则" 之间)**
7. **获取字典值** (Get Dictionary Value) - *获取类型*:
   - **键**: `type`
   - **字典**: 再次选择第 4 步那个 `[字典]`。
   - **⚠️ 关键**: 点击生成的 `[字典值]` 变量，在 **类型 (Type)** 里选择 **文本 (Text)**。如果不选，下一步的 If 会没有 "包含" 选项。
   - *(选好后点击空白处关闭菜单)*

8. **获取字典值** (Get Dictionary Value) - *获取内容*:
   - **键**: `content`
   - **字典**: 也是选择第 4 步那个 `[字典]`。
   - **⚠️ 关键技巧**: 点击这一步生成的 `[字典值]` 变量，重命名为 `Payload`。这样后面好找。

**第四步：分类型处理 (扁平化写法，防套娃)**

9. **如果** (If):
   - **输入**: `[type]`
   - **⚠️ 动作**: 点击蓝色的 **"有任何值" (has any value)** -> 改为 **"包含" (contains)**。
   - **文本**: `text`
   - **由于**:
     - **拷贝至剪贴板** (Copy to Clipboard): 输入 `[Payload]`。
     - **显示通知**: "文字已复制"。
     - **退出快捷指令** (Stop Shortcut)。
   - **结束如果**

10. **如果** (If): *(注意：这个 If 不要在上一个 If 里面，要并列)*
    - **输入**: `[type]`
    - **条件**: 包含 `url`
    - **由于**:
      - **打开 URL** (Open URL): 输入 `[Payload]`。
      - **退出快捷指令** (Stop Shortcut)。
    - **结束如果**

11. **如果** (If):
    - **输入**: `[type]`
    - **条件**: 包含 `image`
    - **由于**:
      - **Base64 解码** (Base64 Decode): `[Payload]` (模式: Base64)
      - **拷贝至剪贴板**: 选择 **`[Base64 解码]`** 的结果。
      - **显示通知**: "图片已复制"。
      - **退出快捷指令** (Stop Shortcut)。
    - **结束如果**

12. **如果** (If):
    - **输入**: `[type]`
    - **条件**: 包含 `file`
    - **由于**:
      - **Base64 解码** (Base64 Decode): `[Payload]`
      - **存储文件**: `[Base64 解码]` 的结果。
      - **显示通知**: "文件已下载"。
      - **退出快捷指令** (Stop Shortcut)。
    - **结束如果**

**第五步：收尾 (兜底)**
13. **如果不为 ok** (对应第6步的Else):
    - *(如果前面的 If status is ok 没通过，或者上面所有类型都没匹配到)*
    - **显示提醒**: "未知的类型或没有内容"。
14. **结束如果**

---

## ❓ 常见问题

**Q: 为什么扫码后还是连不上？**
A: 请确保 iPad 和电脑连的是**同一个 WiFi**。有些路由器会隔离设备，尝试 ping 一下。

**Q: 二维码在哪？**
A: 电脑网页版 Dashboard 的右上角，点击 "� 扫码连接"。

**Q: 只有文本能传，图片传过去是代码？**
A: 确保快捷指令里的 "Base64 编码" 选项中，**"换行符" (Line Breaks)** 选的是 **"无" (None)**。这很重要！
